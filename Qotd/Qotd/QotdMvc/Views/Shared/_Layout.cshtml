<!DOCTYPE html>
<html lang="en">
<head>
    <title>@ViewBag.Title</title>
    <!-- <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />-->
    <link href="@Url.Content("~/Content/bootstrap/css/bootstrap.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/bootstrap/css/bootstrap-responsive.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/redactor/css/redactor.css")" rel="Stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/fontawesome/css/font-awesome.css")" rel="Stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/tipsy/tipsy.css")" rel="Stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/Styles.css")" rel="Stylesheet" type="text/css" />
    @*<link href="@Url.Content("~/Content/token-input-facebook.css")" rel="Stylesheet" type="text/css" />*@
    <link href="@Url.Content("~/Content/token-input.css")" rel="Stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.7.2.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/bootstrap/js/bootstrap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/redactor/redactor.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/tipsy/jquery.tipsy.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/tipsy/jquery.tipsy.hovercard.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.timeago.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/qotd.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.tokeninput.js")" type="text/javascript"></script>
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
</head>

<body>
<script type="text/javascript">
    function onReady()
    {
        jQuery("time.timeago").timeago();

//         $('.ajax-popover').bind('hover',function(event){
//            var el=$(this);
//            $.get(el.attr('data-load'),function(d){
//                el.unbind().popover({content: d}).popover('show');
//                el.removeClass('.ajax-popover');
//            });
//        });

        $('.has-tooltip').tooltip();
    };

    function onPage() {
        $('#answerContent').redactor({
            buttons: [ 'bold', 'italic', 'unorderedlist', 'orderedlist', '|', 'alignleft', 'aligncenter', '|', 'link', '|', 'fullscreen' ]
        });

        $('.tag-input').tokenInput('@Url.Action("Tags", "Home")');

	    $('#answerSubmit').click(
            function () {
                $.post("@Url.Action("AnswerSubmit")", $("#answerForm").serialize(), function(data)
                {
                    if (data.error)
                        alert(data.error);
                    alert('@Url.Action("AnswerSuccess", "Alert")');
                    $('a[href*="#tab1"]').click();
                    $.get('@Url.Action("Answer", "Home")' + '?answerId=' + data.answerId, function(data2)
                    {
                        $('#new-answer').html(data2);
                    });
                }, "json");
            });

        $('#questionSubmit').click(
            function () {
                $.post("@Url.Action("QuestionSubmit")", $("#questionForm").serialize(), function(data)
                {
                    if (data.error)
                        alert(data.error);

                    $("#questionForm")[0].reset();
                    alert('@Url.Action("QuestionSuccess", "Alert")');
                    $('a[href*="#tab2"]').click();
                    $('#questionModal').modal('hide');
                    setTimeout(function()
                    {
                        $.get('@Url.Action("Question", "Home")' + '?questionId=' + data.questionId, function(data2)
                        {
                            $('#new-question').html(data2);
                        });
                        }, 1000);
                }, "json");
            });

        $('#notification-dropdown').bind("click",
            function()
            {
                $("#notification-menu").load("@Url.Action("Notifications", "Home")", function() 
                {
                    jQuery("time.timeago").timeago();
                });
            });

        $('.ajax-link').live("click",
            function(event)
            {
                event.preventDefault();
                var elem = this;
                $.get($(this).attr("href"), function(data)
                {
                    $(elem).closest('.ajax-container').html(data);
                    onReady();
                });
                return false;
            });

        $('.ajax-tab').live("click",
            function(event)
            {
                var tab = $($(this).attr("href"));
                $.get($(this).attr("rel"), function(data)
                {
                    $(tab).html(data);
                    onReady();
                });
                return true;
            });

        $('.comment-input').live('click',
            function(event)
            {
                $(this).next().show();
                return false;
            });

//        $('.comment-input').live('focusout',
//        function(event)
//        {
//            $(this).next().hide();
//            return false;
//        });

        $('.ajax-form').live('submit',
        function(event)
        {
            event.preventDefault();
            var elem = this;
            $.get($(this).attr("action"), $(this).serialize(), function(data)
            {
                $(elem).closest('.ajax-container').html(data);
                onReady();
            });
            return false;
        });
    };

    function alert(url)
    {
        $.get(url, function(data)
        {
            $('#alert-box').html(data);
            $('#alert-box').show();
            setTimeout(function()
            {
                $('#alert-box').fadeOut('slow');
            }, 10000);
        });
    };
    
    $(document).ready(
	function () {
	    onReady();
	    onPage();
	});
</script>
<!-- Top Bar -->
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="@Url.Action("Index", "Home")">Question of the Day</a>
            <!-- notification dropdown -->
            @if (ViewBag.IsAuthenticated && ViewBag.User != null)
            {
            <ul class="nav"><li class="divider-vertical"></li></ul>
            <ul class="nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="notification-dropdown" data-toggle="dropdown">
                        @if (ViewBag.UserPO.UnreadNotifications == 0)
                        {
                        <i class="icon-envelope" style="font-size: 22px; position: relative; top: 3px;"></i>
                        }
                        else
                        {
                        <i class="icon-envelope-alt red" style="font-size: 22px; position: relative; top: 3px;"></i>
                        <span style="background-color: white; color: black; position: relative; left: -10px; top: -10px; border: 1px solid black; opacity: 1.0; font-size: 9px; font-weight: bold; padding: 2px 2px;">@ViewBag.UserPO.UnreadNotifications</span>  
                        }
                    </a>
                    <ul class="dropdown-menu" id="notification-menu" style="width: 300px; overflow: auto; max-height: 600px">
                    </ul>
                </li>
            </ul>
            <ul class="nav"><li class="divider-vertical"></li></ul>
            }
            <!-- --------------------- -->
            <div class="btn-group pull-right">
                <!-- if signed in -->
                @if (ViewBag.IsAuthenticated && ViewBag.User != null)
                {
                    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                      <i class="icon-user"></i>&nbsp;@ViewBag.User.DisplayName
                      <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      <li><a href="#">Account</a></li>
                      <li class="divider"></li>
                      <li><a href="@Url.Action("Signout", "Account")">Sign out</a></li>
   
                    </ul>
                }
                else
                {
                <!-- if not signed in -->
                    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                      <i class="icon-user"></i> Sign in
                      <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      <li><a href="@Url.Action("FacebookSignin", "Account")"><i class="icon-facebook"></i>&nbsp;with Facebook</a></li>
                      <li><a href="@Url.Action("GoogleSignin", "Account")"><i class="icon-google-plus"></i>&nbsp;with Google</a></li>
                      <li><a href="#"><i class="icon-twitter"></i>&nbsp;with Twitter</a></li>
                      <li class="divider"></li>
                      <li><a href="#">More Options...</a></li>
                      <li class="divider"></li>
                      <li><a href="#">Register</a></li>
                    </ul>
                }
            </div>
        </div>
    </div>
</div>
<!-- Answer Modal -->
<div class="modal hide fade" id="answerModal">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>Write your answer...</h3>
  </div>
  <form class="well form-horizontal" action="/" id="answerForm">
  <div class="modal-body">
    <fieldset>
        <div class="control-group">
            <label class="control-label">Title:</label>
            <div class="controls">
                <input type="text" class="input-xlarge" placeholder="Answer title..." name="main"/>
                <p class="help-block">Enter the title of your answer.</p><br />
            </div>
        </div>
        <label>Content:</label>
        <textarea id="answerContent" rows="12" cols="100" style="height: 210px" name="content"></textarea>
    </fieldset>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary" id="answerSubmit" data-dismiss="modal">Submit</a>
  </div>
  </form>
</div>
<!-- Question Modal -->
<div class="modal hide fade" id="questionModal">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>Write your question for tomorrow...</h3>
    </div>
    <form class="well form-horizontal" action="@Url.Action("QuestionSubmit", "Home")" id="questionForm">
        <div class="modal-body">
            <fieldset>
                <div class="control-group">
                    <label class="control-label">Main Text:</label>
                    <div class="controls">
                        <input type="text" class="input-xlarge" placeholder="Main Text..." name="main"/>
                        <p class="help-block">Enter the main text of your question.</p><br />
                    </div>
                    <label class="control-label">Sub Text:</label>
                    <div class="controls">
                        <input type="text" class="input-xlarge" placeholder="Sub Text..." name="sub" />
                        <p class="help-block">Enter the sub text of your question.</p><br />
                    </div>
                    <label class="control-label">More Information:</label>
                    <div class="controls">
                        <textarea rows="5" cols="120" name="details" class="input-xlarge"></textarea>
                        <p class="help-block">Enter the main text of your question.</p><br />
                    </div>
                    <label class="control-label">Tags:</label>
                    <div class="controls">
                        <input type="text" class="tag-input" name="tags" />
                        <p class="help-block">Enter the tags for your question.</p><br />
                    </div>
                </div>
            </fieldset>
        </div>
        <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Close</a>
        <a href="#" class="btn btn-primary" id="questionSubmit">Submit</a>
        </div>
    </form>
</div>
<div class="container">
@if (ViewBag.HideQuestion == null || (!ViewBag.HideQuestion))
{
    <div class="hero-unit">
        <h1>@QotdMvc.DisplayHelper.QuestionMainText(ViewBag.Question.MainText)</h1>
        <p></p>
        <p>@ViewBag.Question.SubText</p>
        <a href=""><span class="label label-info">More Info</span></a>
         @if (ViewBag.IsAuthenticated && ViewBag.User != null)
         {
             if (ViewBag.Question.QuestionType == Qotd.Entities.QuestionType.Debate)
             {
                <a href="" class="btn btn-danger" style="width: 75px"><i class="icon-thumbs-down icon-white" style="font-size: 18px; padding-right: 10px; position: relative; top:0px"></i>Disagree</a>
                <a href="" class="btn btn-success" style="width: 75px"><i class="icon-thumbs-up icon-white" style="font-size: 18px; padding-right: 10px; position: relative; top:3px"></i>&nbsp;Agree</a>
             }
             <a href="#questionModal" class="btn btn-warning pull-right" style="width:155px" data-toggle="modal"><i class="icon-question-sign icon-white"  style="font-size: 18px; padding-right: 10px; position: relative; top: 2px"></i>&nbsp;Pose a Question&nbsp;<i class="icon-chevron-right icon-white" style="font-size: 18px; padding-left: 10px; position: relative; top: 2px"></i></a> 
             <a href="#answerModal" class="@QotdMvc.DisplayHelper.AnswerButtonClass(ViewBag.Question.QuestionType, ViewBag.HasPickedSide)" data-toggle="modal" style="margin-right: 8px; width: 155px"><i class="icon-edit icon-white"  style="font-size: 18px; padding-right: 10px; position: relative; top: 2px"></i>&nbsp;Submit an Answer&nbsp;<i class="icon-chevron-right icon-white" style="font-size: 18px; padding-left: 10px; position: relative; top: 2px"></i></a>
         }
    </div>
}
    @RenderBody()
</div>
</body>
</html>
